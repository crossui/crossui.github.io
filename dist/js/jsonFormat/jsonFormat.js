function $id(e){return document.getElementById(e)}function IsArray(e){return e&&"object"==typeof e&&"number"==typeof e.length&&!e.propertyIsEnumerable("length")}function Process(jsondata,jsonWrap){SetTab(),window.IsCollapsible=!0;var json=jsondata,html="";try{""==json&&(json='""');var obj=eval("["+json+"]");html=ProcessObject(obj[0],0,!1,!1,!1),$id(jsonWrap).innerHTML="<PRE class='CodeContainer'>"+html+"</PRE>"}catch(e){alert("JSON数据格式不正确:\n"+e.message),$id(jsonWrap).innerHTML=""}}function ProcessObject(e,n,o,i,t){var s="",a=o?"<span class='Comma'>,</span> ":"",l=typeof e;if(IsArray(e))if(0==e.length)s+=GetRow(n,"<span class='ArrayBrace'>[ ]</span>"+a,t);else{s+=GetRow(n,"<span class='ArrayBrace'>[</span>"+(window.IsCollapsible?'<span><img src="'+window.ImgExpanded+'" onClick="ExpImgClicked(this)" /></span><span class=\'collapsible\'>':""),t);for(var r=0;r<e.length;r++)s+=ProcessObject(e[r],n+1,r<e.length-1,!0,!1);s+=GetRow(n,(window.IsCollapsible?"</span>":"")+"<span class='ArrayBrace'>]</span>"+a)}else if("object"==l)if(null==e)s+=FormatLiteral("null","",a,n,i,"Null");else if(e.constructor==window._dateObj.constructor)s+=FormatLiteral("new Date("+e.getTime()+") /*"+e.toLocaleString()+"*/","",a,n,i,"Date");else if(e.constructor==window._regexpObj.constructor)s+=FormatLiteral("new RegExp("+e+")","",a,n,i,"RegExp");else{var c=0;for(var d in e)c++;if(0==c)s+=GetRow(n,"<span class='ObjectBrace'>{ }</span>"+a,t);else{s+=GetRow(n,"<span class='ObjectBrace'>{</span>"+(window.IsCollapsible?'<span><img src="'+window.ImgExpanded+'" onClick="ExpImgClicked(this)" /></span><span class=\'collapsible\'>':""),t);var p=0;for(var d in e){var u=window.QuoteKeys?'"':"";s+=GetRow(n+1,"<span class='PropertyName'>"+u+d+u+"</span>: "+ProcessObject(e[d],n+1,++p<c,!1,!0))}s+=GetRow(n,(window.IsCollapsible?"</span>":"")+"<span class='ObjectBrace'>}</span>"+a)}}else"number"==l?s+=FormatLiteral(e,"",a,n,i,"Number"):"boolean"==l?s+=FormatLiteral(e,"",a,n,i,"Boolean"):"function"==l?e.constructor==window._regexpObj.constructor?s+=FormatLiteral("new RegExp("+e+")","",a,n,i,"RegExp"):s+=FormatLiteral(e=FormatFunction(n,e),"",a,n,i,"Function"):s+="undefined"==l?FormatLiteral("undefined","",a,n,i,"Null"):FormatLiteral(e.toString().split("\\").join("\\\\").split('"').join('\\"'),'"',a,n,i,"String");return s}function FormatLiteral(e,n,o,i,t,s){"string"==typeof e&&(e=e.split("<").join("&lt;").split(">").join("&gt;"));var a="<span class='"+s+"'>"+n+e+n+o+"</span>";return t&&(a=GetRow(i,a)),a}function FormatFunction(e,n){for(var o="",i=0;i<e;i++)o+=window.TAB;for(var t=n.toString().split("\n"),s="",i=0;i<t.length;i++)s+=(0==i?"":o)+t[i]+"\n";return s}function GetRow(e,n,o){for(var i="",t=0;t<e&&!o;t++)i+=window.TAB;return null!=n&&n.length>0&&"\n"!=n.charAt(n.length-1)&&(n+="\n"),i+n}function CollapsibleViewClicked(){$id("CollapsibleViewDetail").style.visibility=$id("CollapsibleView").checked?"visible":"hidden",Process()}function QuoteKeysClicked(){window.QuoteKeys=$id("QuoteKeys").checked,Process()}function CollapseAllClicked(){EnsureIsPopulated(),TraverseChildren($id(jsonWrap),function(e){"collapsible"==e.className&&MakeContentVisible(e,!1)},0)}function ExpandAllClicked(){EnsureIsPopulated(),TraverseChildren($id(jsonWrap),function(e){"collapsible"==e.className&&MakeContentVisible(e,!0)},0)}function MakeContentVisible(e,n){var o=e.previousSibling.firstChild;o.tagName&&"img"==o.tagName.toLowerCase()&&(e.style.display=n?"inline":"none",e.previousSibling.firstChild.src=n?window.ImgExpanded:window.ImgCollapsed)}function TraverseChildren(e,n,o){for(var i=0;i<e.childNodes.length;i++)TraverseChildren(e.childNodes[i],n,o+1);n(e,o)}function ExpImgClicked(e){var n=e.parentNode.nextSibling;if(n){var o="none",i=window.ImgCollapsed;"none"==n.style.display&&(o="inline",i=window.ImgExpanded),n.style.display=o,e.src=i}}function CollapseLevel(e){EnsureIsPopulated(),TraverseChildren($id(jsonWrap),function(n,o){"collapsible"==n.className&&(o>=e?MakeContentVisible(n,!1):MakeContentVisible(n,!0))},0)}function SetTab(){window.TAB=MultiplyString(2,window.SINGLE_TAB)}function EnsureIsPopulated(){!$id(jsonWrap).innerHTML&&$id("RawJson").value&&Process()}function MultiplyString(e,n){for(var o=[],i=0;i<e;i++)o.push(n);return o.join("")}function SelectAllClicked(){document.selection&&document.selection.empty?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges();var e=document.body&&document.body.createTextRange?document.body.createTextRange():document.createRange();e.selectNode?e.selectNode($id(jsonWrap)):e.moveToElementText&&e.moveToElementText($id(jsonWrap)),e.select?e.select($id(jsonWrap)):window.getSelection().addRange(e)}function LinkToJson(){var e=$id("RawJson").value;e=escape(e.split("/n").join(" ").split("/r").join(" ")),$id("InvisibleLinkUrl").value=e,$id("InvisibleLink").submit()}window.SINGLE_TAB="  ",window.ImgCollapsed="../images/Collapsed.gif",window.ImgExpanded="../images/Expanded.gif",window.QuoteKeys=!0,window._dateObj=new Date,window._regexpObj=new RegExp;